# 모델이 표현하는 트랜잭션의 이해
>https://velog.io/@i_am_heeeun/SQL-%EB%AA%A8%EB%8D%B8%EC%9D%B4-%ED%91%9C%ED%98%84%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-%EC%9D%B4%ED%95%B4

> 트랜잭션은 데이터베이스의 논리적 연산단위이다.<br>
> 데이터 정합성을 위해 작업은 전부 실행되든지 아니면 전부 취소되든지 해야한다. <br>
> 즉 하나의 업무 단위로 묶여서 처리돼야 한다는 것이고 이러한 업무 단위를 트랜잭션이라고 한다.

<img src='../img/2. 데이터 모델과 SQL/data5_1.jpg' width='400' height='200'>

고객이 상품을 구매하면서 발생하는 것이 주문이다. 또한 하나의 주문은 여러개의 상품을 구매할 수 있다.<br>
해당 ERD에서는 주문과 주문상세가 필수적관계로 되어있어 주문이 발생하면 주문상세 데이터도 함께 발생이 된다.<BR>

<img src='../img/2. 데이터 모델과 SQL/data5_2.jpg' width='400' height='200'>

해당 ERD는 주문,주문상세가 선택적관계로 되어있어 주문이 발생해도 주문상세가 발생안할수 있다.


일반적인 쇼핑몰 모델은 주문과 주문상세의 데이터가 태생적으로 동시에 발생된다면 당연히 계좌이체의 경우처럼 하나의 트랜잭션으로 묶어서 처리해야 한다.<BR>
All or Nothing인 원자성이 보장되도록 개발을 해야한다. 즉 커밋의 단위를 하나로 묶어야 함을 의미한다. 그래야만 트랜잭션은 전체가 실행되거나 혹은 전체가 취소될 수 있다.

```
//고객의 주문 발생
Step1. 주문API{주문입력(주문번호=>110001, 고객명=>A, ...);
			주문상세입력(주문번호=>110001, 상품번호=>1234,...);
            commit();}
위의 의사 코드는 고객의 주문이 발생할 때 주문상세도 같이 발생되는것을 표현한다.            
```

```
// 고객의 주문 발생
Step1. 주문API{주문입력(주문번호=>110001, 고객명=>A, ...);
			 commit();}
Step2. 주문상세API{주문상세입력(주문번호=>110001, 상품번호=>1234,...);
				commit();
}

위의 의사 코드는 고객의 주문과 주문상세가 따로 발생되는것을 표현한다.
```
위의 의사코드처럼 수행할 경우 주문API와 주문상세API를 각각 호출하며 문제는 주문하는 도중에 핸드폰 배터리가 다 되었을수도 있고 앱을 실수로 꺼버렸을 수도 있으며 장애가 발생하여 연결이 끊어질 수도 있다.

> 다양한 요인들로 인해 함께 수행되지 못하고 하나만 수행된다면 잘못된 데이터가 발생한다. 반드시 하나의 트랜잭션으로 처리 되어야 한다.